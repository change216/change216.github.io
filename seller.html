<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <meta http-equiv="CACHE-CONTROL" content="NO-CACHE">
  <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/milligram/1.2.3/milligram.min.css">
  <link rel="stylesheet" type="text/css" href="https:///HongIP.github.io/usertype.css"> <!--<form><div class="dynamiclabel"></div> -->
  <title> SELLER TEST </title>
  <script src="https://cdn.rawgit.com/ethereumjs/browser-builds/ddb27f8d/dist/ethereumjs-tx/ethereumjs-tx-1.3.3.min.js"></script>
    <script src="https://unpkg.com/ipfs-api@9.0.0/dist/index.js"
    integrity="sha384-5bXRcW9kyxxnSMbOoHzraqa7Z0PQWIao+cgeg327zit1hz5LZCEbIMx/LWKPReuB"
    crossorigin="anonymous"></script>
</head>

  <body>
      <h3> SELLER</h3>
      
           
          <ul>
              <li>가입: <div class="dynamiclabel"><input id="addmember" type="text">
            <label for="addmember">이름</label></div>
            <div class="dynamiclabel"><input id="newid" type="text">
            <label for="newid">아이디</label></div></li>
            <div class="dynamiclabel"><input id="newphonenum" type="text">
              <label for="newphonenum">전화번호</label></div></li>
            <li><button onclick="setSeller()">판매자로 가입</button><button onclick="setBuyer()">구매자로 가입</button></li>
        
            
            ========================================판매자==========================================

            <li>판매 물품 등록<button onclick="uploadpage()">등록페이지로</button></li>
            <li>판매 물품 정보 입력
              <div class="dynamiclabel">
                  <form action="/">
                    <fieldset>    
                           <input type="file" name="photo" id="photo">
                           <button type="button" onclick="upload()">Upload</button>
                    </fieldset>
                   </form> 
                <input id="pro_Image" type="text">
                <label for="pro_Image">사진</label>
              </div>
              <div class="dynamiclabel">
                <input id="pro_addr" type="text">
                <label for="pro_addr">매물 주소</label>
              </div>
              <div class="dynamiclabel">
                <input id="pro_info" type="text">
                <label for="pro_info">매물 정보</label>
              </div>
              <div class="dynamiclabel">
                <input id="pro_price" type="text">
                <label for="pro_price">매물 가격(ether)</label>
              </div>
              <div class="dynamiclabel">
                <input id="pro_tag" type="text">
                <label for="pro_tag">설명</label>
              </div>
              <div class="dynamiclabel">
                <input id="pro_name" type="text">
                <label for="pro_name">매물 이름</label><button onclick="setUploadProduct()">매물 등록하기</button>
                </div>
              
              
            </li>

            <li>개인정보 서류등록</li>
            <li>
            <div class="dynamiclabel">    
                <form action="/">
                 <fieldset>    
                        <input type="file" name="photo" id="photo">
                        <button type="button" onclick="upload()">Upload</button>
                    </fieldset>
                </form> 
              <input id="docu_Image" type="text">
              <label for="docu_Image">계약사진</label>
            </div>
            <div class="dynamiclabel">
              <input id="docu_name" type="text">
              <label for="docu_name">계약 이름</label>
            </div>
            <div class="dynamiclabel">
              <input id="docu_info" type="text">
              <label for="docu_info">계약 정보</label>
              <button onclick="SetMyDocument()">서류 등록하기</button>
            </div></li>

            

            



            <button onclick="Updatepage()">매물정보 수정페이지로 가기</button>
            <li>판매 물품 정보 수정
                <div class="dynamiclabel">
                <input id="pro_updateIndex" type="text">
                <label for="pro_updateIndex">인덱스</label>
                </div>
              <div class="dynamiclabel">
                <input id="pro_updateImage" type="text">
                <label for="pro_updateImage">사진</label>
              </div>
              <div class="dynamiclabel">
                <input id="pro_updateaddr" type="text">
                <label for="pro_updateaddr">매물 주소</label>
              </div>
              <div class="dynamiclabel">
                <input id="pro_updateinfo" type="text">
                <label for="pro_updateinfo">매물 정보</label>
              </div>
              <div class="dynamiclabel">
                <input id="pro_updateprice" type="text">
                <label for="pro_updateprice">매물 가격(ether)</label>
              </div>
              <div class="dynamiclabel">
                <input id="pro_updatetag" type="text">
                <label for="pro_updatetag">설명</label>
              </div>
              <div class="dynamiclabel">
                <input id="pro_updatename" type="text">
                <label for="pro_updatename">매물 이름</label>
              </div>
              <button onclick="setUpdateProduct()">수정 완료버튼</button>
            </li>

            <button onclick="closetrans()">거래 종료</button>
            <button onclick="Allstoptransclose()">거래 취소</button>

            <li>
            <div class="dynamiclabel">
                <input id="trans_member" type="text">
                <label for="trans_member">맴버 컨트랙트</label>
              </div>
              <div class="dynamiclabel">
                <input id="trans_proidx" type="text">
                <label for="trans_proidx">매물인덱스</label>
              </div>
              <button onclick="setTrans()">트랜스 시작버튼</button>
            </li>
        

            <li>정보 출력
                <div class="dynamiclabel">
                    <input id="pro_index" type="text">
                    <label for="pro_index">매물 인덱스</label>
                  </div>
                  <button onclick="getProduct()">정보 출력버튼</button>
              <span id="returninfo"></span><br>
              <span id="returnprice"></span><br>
              <span id="returntag"></span><br>
              <span id="returnname"></span><br>
              <span id="returnimage"></span><br>
              <span id="returnowner"></span><br>
              <span id="returnnumber"></span>
            </li>

            <li>판매자 정보
                <div class="dynamiclabel">
                    <input id="seller_addr" type="text">
                    <label for="seller_addr">판매자 주소</label>
                  </div>
                  <button onclick="getsellerinfo()">정보 출력버튼</button>
                <span id="membertype"></span><br>
                <span id="phonenumber"></span><br>
                <span id="reliability"></span><br>
                <span id="Status_Numberofpeople"></span><br>
                <span id="Status_sum"></span><br>
                <span id="Status_avg"></span><br>
                <span id="id"></span><br>
                <span id="name"></span>

            </li>
            <li>물품 정보
                <span id="membertype"></span><br>
                <span id="phonenumber"></span><br>
                <span id="reliability"></span><br>
                <span id="Status_Numberofpeople"></span><br>
                <span id="Status_sum"></span><br>
                <span id="Status_avg"></span><br>
                <span id="id"></span><br>
                <span id="name"></span>
              </li>

              <li>
                거래 완료 품목
                <div class="dynamiclabel">
                    <input id="tran_addr" type="text">
                    <label for="tran_addr">트랜젝션 주소</label>
                  </div>
                  <button onclick="getsRoomContract()">정보 출력버튼</button>
                <span id="membertype"></span><br>
                <span id="phonenumber"></span><br>
                <span id="reliability"></span><br>
                <span id="Status_Numberofpeople"></span>

              </li>
            <li>판매 시작 :
              <div class="dynamiclabel"><input id="newsale" type="text">
              <label for="newsale">판매 기간</label></div></li>
              <button onclick="startsale()">판매 시작</button>
            </ul>      
      
      <button href="http://192.168.0.68:8080/김창은.html" class="css3dbutton">
        <span class="outer">
        <span class="top">Sign Up!</span>
        <span class="bottom">It's free and fast</span>
        </span>
      </button>
  </body>



  <script>
        var membersContract = web3.eth.contract([{"constant":true,"inputs":[{"name":"","type":"address"}],"name":"buyerDetail","outputs":[{"name":"flag","type":"bool"},{"name":"id","type":"string"},{"name":"name","type":"string"},{"name":"Tell","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":false,"inputs":[{"name":"_index","type":"uint256"}],"name":"favoriteProduct","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":true,"inputs":[{"name":"_index","type":"uint256"}],"name":"GetMyProduct","outputs":[{"name":"","type":"string"},{"name":"","type":"uint256"},{"name":"","type":"string"},{"name":"","type":"string"},{"name":"","type":"string"},{"name":"","type":"address"},{"name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[{"name":"","type":"uint256"}],"name":"productArray","outputs":[{"name":"ProductAddress","type":"string"},{"name":"ProductInfo","type":"string"},{"name":"Price","type":"uint256"},{"name":"Tag","type":"string"},{"name":"ProductName","type":"string"},{"name":"ImageHashsrc","type":"string"},{"name":"owner","type":"address"},{"name":"Productnumber","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[{"name":"_index","type":"uint256"}],"name":"IndexToPrice","outputs":[{"name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[],"name":"GetMyProductnumber","outputs":[{"name":"","type":"uint256[]"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[{"name":"_trans","type":"address"}],"name":"getRoomContract","outputs":[{"name":"","type":"address"},{"name":"","type":"address"},{"name":"","type":"uint256"},{"name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":false,"inputs":[{"name":"_trans","type":"address"},{"name":"buyer","type":"address"},{"name":"seller","type":"address"},{"name":"price","type":"uint256"}],"name":"setRoomContract","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":true,"inputs":[],"name":"GetProdctsSize","outputs":[{"name":"count","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[],"name":"getSellerScore","outputs":[{"name":"","type":"uint256"},{"name":"","type":"uint256"},{"name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[{"name":"_index","type":"uint256"}],"name":"IndexToOwner","outputs":[{"name":"","type":"address"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":false,"inputs":[{"name":"_name","type":"string"},{"name":"_id","type":"string"},{"name":"_tell","type":"uint256"}],"name":"setBuyer","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":false,"inputs":[{"name":"_ImageHashsrc","type":"string"},{"name":"_ProductAddress","type":"string"},{"name":"_ProductInfo","type":"string"},{"name":"_Price","type":"uint256"},{"name":"_Tag","type":"string"},{"name":"_ProductName","type":"string"}],"name":"SetUploadProduct","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":false,"inputs":[{"name":"_applicant","type":"address"},{"name":"_span","type":"uint256"}],"name":"SetAllowMyDocument","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":false,"inputs":[{"name":"_trans","type":"address"},{"name":"score","type":"uint256"}],"name":"SellerEvaluation","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":false,"inputs":[{"name":"product_index","type":"uint256"},{"name":"_ImageHashsrc","type":"string"},{"name":"_ProductAddress","type":"string"},{"name":"_ProductInfo","type":"string"},{"name":"_Price","type":"uint256"},{"name":"_Tag","type":"string"},{"name":"_ProductName","type":"string"}],"name":"SetUpdateProduct","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":false,"inputs":[{"name":"_index","type":"uint256"},{"name":"myaddress","type":"address"}],"name":"setTransOwner","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":true,"inputs":[],"name":"favoriteProductresult","outputs":[{"name":"","type":"uint256[]"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":false,"inputs":[{"name":"_name","type":"string"},{"name":"_id","type":"string"},{"name":"_tell","type":"uint256"}],"name":"setSeller","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":true,"inputs":[{"name":"","type":"address"}],"name":"sellerDetail","outputs":[{"name":"flag","type":"bool"},{"name":"Tell","type":"uint256"},{"name":"reliability","type":"uint256"},{"name":"Status_Numberofpeople","type":"uint256"},{"name":"Status_sum","type":"uint256"},{"name":"Status_avg","type":"uint256"},{"name":"id","type":"string"},{"name":"name","type":"string"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[{"name":"_id","type":"string"}],"name":"getMyAddress","outputs":[{"name":"","type":"address"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":false,"inputs":[{"name":"_DocumentName","type":"string"},{"name":"_DocumentImageHashsrc","type":"string"},{"name":"_DocumentImageInfo","type":"string"}],"name":"SetUploadMyDocument","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":true,"inputs":[{"name":"","type":"uint256"}],"name":"DocumentArray","outputs":[{"name":"DocumentName","type":"string"},{"name":"DocumentImageHashsrc","type":"string"},{"name":"DocumentImageInfo","type":"string"},{"name":"Documentowner","type":"address"},{"name":"Documentnumber","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[{"name":"_person","type":"address"},{"name":"_index","type":"uint256"}],"name":"getBuyerDocument","outputs":[{"name":"_allowReference","type":"bool"},{"name":"_approveBlockNo","type":"uint256"},{"name":"_refLimitBlockNo","type":"uint256"},{"name":"_applicant","type":"address"},{"name":"_DocumentName","type":"string"},{"name":"_DocumentImageHashsrc","type":"string"},{"name":"_DocumentImageInfo","type":"string"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[],"name":"getDocumentList","outputs":[{"name":"","type":"uint256[]"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[{"name":"addr","type":"address"}],"name":"getType","outputs":[{"name":"","type":"int256"}],"payable":false,"stateMutability":"view","type":"function"}]);
        var membersaddress = '0x9cede71c00227ea47284bd0474a38d7ed388e411';
        var members;
        var myaccount;

        window.addEventListener('load', function() {
        // Checking if Web3 has been injected by the browser (Mist/MetaMask)
        if (typeof web3 !== 'undefined') {
        // Use Mist/MetaMask's provider
        window.web3 = new Web3(web3.currentProvider);
        console.log('connect current');
        } else {
        console.log('No web3? You should consider trying MetaMask!')
        // fallback - use your fallback strategy (local node / hosted node + in-dapp id mgmt / fail)
        window.web3 = new Web3(new Web3.providers.HttpProvider("http://localhost:8545"));
        }
        // Now you can start your app & access web3 freely:
        startApp();
        });


        function startApp() {

        members = membersContract.at(membersaddress);        
        
            web3.eth.getAccounts(function(e,r){
                myaccount =r[0];
                //document.getElementById('account').innerText = r[0];
            })            
        }

  </script>
  
  <script>

      //매물 등록하는 함수
      function setUploadProduct() {
          console.log(myaccount);
        let _ImageHashsrc = document.getElementById('pro_Image').value;
        let _ProductAddress = document.getElementById('pro_addr').value;
        let _ProductInfo = document.getElementById('pro_info').value;
        let _Price = document.getElementById('pro_price').value;
        let _Tag = document.getElementById('pro_tag').value;
        let _ProductName = document.getElementById('pro_name').value;

        members.SetUploadProduct(
            _ImageHashsrc,_ProductAddress,_ProductInfo,_Price,_Tag,_ProductName,
            function(e,r){ if(!e){console.log("매물 등록 성공~!~!~");alert("매물등록 성공 :" + r)}});
      }

      //매물 수정하는 함수
      function setUpdateProduct(){

        
        let _index = document.getElementById('pro_updateIndex').value;
        let _ImageHashsrc = document.getElementById('pro_updateImage').value;
        let _ProductAddress = document.getElementById('pro_updateaddr').value;
        let _ProductInfo = document.getElementById('pro_updateinfo').value;
        let _Price = document.getElementById('pro_updateprice').value;
        let _Tag = document.getElementById('pro_updatetag').value;
        let _ProductName = document.getElementById('pro_updatename').value;
       
        members.GetMyProduct(_index,function(e,r){
          if(e) {
            alert("존재하지 않는 매물입니다.");
            return;}

          members.SetUpdateProduct(_index,_ImageHashsrc,_ProductAddress,_ProductInfo,_Price,_Tag,_ProductName,
          function(e,r){ 
          if(!e){
          console.log("매물 수정완료!!"); 
          alert("매물수정 성공 :" + r)}

        });
        })

      

      }

      //개인정보 서류 등록함수
      function SetMyDocument() {
        let _DocumentName = document.getElementById('docu_name').value;
        let _DocumentImageHashsrc = document.getElementById('docu_Image').value;
        let _DocumentImageInfo = document.getElementById('docu_info').value;
      
        members.SetUploadMyDocument(
            _DocumentName,_DocumentImageHashsrc,_DocumentImageInfo,
            function(e,r){if(!e){console.log("개인서류 등록 성공~!~!~");alert("개인서류 등록 성공 :" + r)}}); 
      }


  </script>
  <script type="text/javascript">
    function upload() {
      const reader = new FileReader();
      reader.onloadend = function() {
        const ipfs = window.IpfsApi('localhost', 5001) // Connect to IPFS
        const buf = ethereumjs.Buffer.Buffer(reader.result) // Convert data into buffer
        ipfs.files.add(buf, (err, result) => { // Upload buffer to IPFS
          if(err) {
            console.error(err)
            return;
          }
          //let url = `https://ipfs.io/ipfs/${result[0].hash}`
          let url = `http://localhost:8080/ipfs/${result[0].hash}`
          console.log(`Url --> ${url}`)
          document.getElementById("pro_Image").value= result[0].hash;
          document.getElementById("docu_Image").value= result[0].hash;
          
          //document.getElementById("pro_Image").href= url
          //document.getElementById("output").src = url
        })
      }
      const photo = document.getElementById("photo");
      reader.readAsArrayBuffer(photo.files[0]); // Read Provided File
    }
  </script>
  <html>